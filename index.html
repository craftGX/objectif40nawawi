<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ToDo 20 Hadith Nawawi</title>
    <style>
      :root {
        --bg-dark: #050814;
        --card-bg: #0b1020;
        --accent-blue: #00a9e0;
        --accent-green: #39ff14;
        --accent-soft: #1e293b;
        --text-main: #f9fafb;
        --text-muted: #9ca3af;
        --danger: #f97373;
        --border: #1f2937;
        --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.6);
        --radius-lg: 18px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: radial-gradient(circle at top, #0f172a 0, var(--bg-dark) 45%, #020617 100%);
        color: var(--text-main);
        display: flex;
        justify-content: center;
        padding: 16px 10px;
      }

      .app {
        width: 100%;
        max-width: 960px;
        background: linear-gradient(135deg, rgba(0, 169, 224, 0.08), rgba(57, 255, 20, 0.06));
        border-radius: 22px;
        padding: 18px 14px 22px;
        box-shadow: var(--shadow-soft);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(148, 163, 184, 0.3);
      }

      header {
        margin-bottom: 16px;
        text-align: center;
      }

      h1 {
        margin: 0 0 6px 0;
        font-size: 1.35rem;
        letter-spacing: 0.04em;
        text-transform: uppercase;
        color: var(--accent-green);
        text-shadow: 0 0 8px rgba(57, 255, 20, 0.65);
      }

      .subtitle {
        margin: 0;
        font-size: 0.8rem;
        color: var(--text-muted);
      }

      .layout {
        display: grid;
        grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.2fr);
        gap: 16px;
      }

      @media (max-width: 800px) {
        .layout {
          grid-template-columns: minmax(0, 1fr);
        }
      }

      .card {
        background: radial-gradient(
          circle at top left,
          rgba(0, 169, 224, 0.25),
          rgba(15, 23, 42, 0.98) 45%
        );
        border-radius: var(--radius-lg);
        padding: 16px 16px 18px;
        border: 1px solid rgba(51, 65, 85, 0.8);
        box-shadow: 0 14px 35px rgba(15, 23, 42, 0.9);
        margin-bottom: 14px;
      }

      .card-title {
        font-size: 1rem;
        font-weight: 600;
        letter-spacing: 0.03em;
        text-transform: uppercase;
        margin-bottom: 10px;
        border-bottom: 1px solid rgba(148, 163, 184, 0.2);
        padding-bottom: 6px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
      }

      .card-subtitle {
        font-size: 0.75rem;
        color: var(--text-muted);
      }

      /* Liste objectifs */
      ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .todo {
        display: flex;
        align-items: center;
        padding: 11px 0;
        border-bottom: 1px solid rgba(31, 41, 55, 0.8);
        font-size: 0.95rem;
        gap: 10px;
        transition: background 0.17s;
      }

      .todo:last-child {
        border-bottom: none;
      }

      .todo label {
        flex: 1;
        cursor: pointer;
        transition: color 0.17s;
        font-weight: 500;
        word-break: break-word;
      }

      input[type="checkbox"] {
        width: 20px;
        height: 20px;
        accent-color: var(--accent-green);
        cursor: pointer;
        margin: 0 6px 0 0;
      }

      .todo.checked {
        background: rgba(34, 197, 94, 0.12);
      }

      .todo.checked label {
        color: var(--accent-green);
        text-decoration: line-through;
      }

      /* Progression */
      #progressText {
        text-align: center;
        font-weight: 600;
        margin-bottom: 7px;
        color: var(--accent-blue);
        font-size: 0.95rem;
        letter-spacing: 0.02em;
      }

      /* on garde UNIQUEMENT ce style comme contenant */
      #progressBar {
        width: 100%;
        height: 10px;
        margin: 10px 0 4px 0;
        background: rgba(15, 23, 42, 0.9);
        border-radius: 999px;
        overflow: hidden;
        border: 1px solid rgba(148, 163, 184, 0.35);
      }

      /* barre interne animée */
      #progressFill {
        height: 100%;
        width: 0;
        background: linear-gradient(90deg, var(--accent-blue), var(--accent-green));
        transition: width 0.2s ease;
      }

      .btn {
        border-radius: 999px;
        padding: 7px 16px;
        border: none;
        font-size: 0.8rem;
        font-weight: 600;
        letter-spacing: 0.04em;
        text-transform: uppercase;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        transition: transform 0.07s ease, box-shadow 0.12s ease, background 0.15s ease;
        white-space: nowrap;
      }

      .btn-danger {
        background: linear-gradient(135deg, #f97373, #b91c1c);
        color: #fef2f2;
        box-shadow: 0 10px 18px rgba(220, 38, 38, 0.5);
      }

      .btn-danger:hover {
        transform: translateY(-1px);
        box-shadow: 0 14px 24px rgba(220, 38, 38, 0.65);
      }

      .btn-secondary {
        background: rgba(15, 23, 42, 0.9);
        color: var(--text-muted);
        border: 1px solid rgba(148, 163, 184, 0.5);
      }

      .btn-secondary:hover {
        background: rgba(15, 23, 42, 1);
        transform: translateY(-1px);
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--accent-blue), var(--accent-green));
        color: #0b1020;
        box-shadow: 0 10px 22px rgba(0, 169, 224, 0.45);
        border: 1px solid rgba(56, 189, 248, 0.8);
      }

      .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 14px 28px rgba(56, 189, 248, 0.65);
        filter: brightness(1.05);
      }

      .actions-row {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-top: 10px;
        flex-wrap: wrap;
      }

      .field {
        display: flex;
        flex-direction: column;
        gap: 4px;
        margin-bottom: 10px;
      }

      label {
        font-size: 0.8rem;
        color: var(--text-muted);
      }

      input[type="number"],
      input[type="text"],
      textarea {
        border-radius: 10px;
        border: 1px solid rgba(148, 163, 184, 0.6);
        background: rgba(15, 23, 42, 0.9);
        color: var(--text-main);
        padding: 7px 10px;
        font-size: 0.85rem;
        outline: none;
        transition: border 0.18s ease, box-shadow 0.18s ease, background 0.18s ease;
      }

      textarea {
        resize: vertical;
        min-height: 60px;
      }

      input[type="number"]:focus,
      input[type="text"]:focus,
      textarea:focus {
        border-color: var(--accent-blue);
        box-shadow: 0 0 0 1px rgba(0, 169, 224, 0.6);
        background: rgba(15, 23, 42, 0.98);
      }

      .info {
        font-size: 0.75rem;
        color: var(--text-muted);
      }

      /* Tableau recap */
      .recap-title {
        font-size: 0.9rem;
        color: var(--text-muted);
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.8rem;
      }

      th,
      td {
        padding: 7px 8px;
        border-bottom: 1px solid rgba(31, 41, 55, 0.8);
        text-align: left;
      }

      th {
        font-size: 0.72rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-muted);
        background: rgba(15, 23, 42, 0.95);
      }

      tr:last-child td {
        border-bottom: none;
      }

      .percent-good {
        color: var(--accent-green);
        font-weight: 600;
      }

      .percent-bad {
        color: var(--danger);
        font-weight: 600;
      }

      .compare-better {
        color: var(--accent-green);
        font-weight: 600;
      }

      .compare-worse {
        color: var(--danger);
        font-weight: 600;
      }

      .compare-same {
        color: var(--text-muted);
        font-weight: 600;
      }

      .empty {
        text-align: center;
        padding: 14px 6px;
        color: var(--text-muted);
      }

      /* Heatmap simple */
      .heatmap {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 4px;
        margin-top: 8px;
      }

      .heat-label {
        font-size: 0.7rem;
        color: var(--text-muted);
        text-align: center;
      }

      .heat-cell {
        width: 20px;
        height: 20px;
        border-radius: 4px;
        background: rgba(15, 23, 42, 0.8);
        border: 1px solid rgba(31, 41, 55, 0.8);
        font-size: 0.7rem;
        color: var(--text-muted);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .heat-0 {
        background: rgba(15, 23, 42, 0.8);
      }

      .heat-25 {
        background: rgba(248, 113, 113, 0.5);
      }

      .heat-50 {
        background: rgba(234, 179, 8, 0.5);
      }

      .heat-75 {
        background: rgba(59, 130, 246, 0.6);
      }

      .heat-100 {
        background: rgba(34, 197, 94, 0.7);
      }

      /* Graph 7 jours (barres) */
      .bar-graph {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 6px;
        align-items: flex-end;
        margin-top: 8px;
      }

      .bar {
        position: relative;
        height: 60px;
        border-radius: 4px;
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(31, 41, 55, 0.9);
        overflow: hidden;
      }

      .bar-fill {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(180deg, var(--accent-blue), var(--accent-green));
        width: 100%;
        height: 0;
        transition: height 0.3s;
      }

      .bar-label {
        font-size: 0.65rem;
        color: var(--text-muted);
        text-align: center;
        margin-top: 2px;
      }

      /* Stats par objectif */
      .objectifs-table {
        font-size: 0.78rem;
      }

      .objectifs-table th,
      .objectifs-table td {
        padding: 5px 6px;
      }

      .badge-small {
        display: inline-flex;
        align-items: center;
        padding: 2px 8px;
        border-radius: 999px;
        border: 1px solid rgba(250, 204, 21, 0.8);
        color: #facc15;
        font-size: 0.68rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .badges-row {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-top: 4px;
      }

      .intent-box {
        margin-top: 8px;
        font-size: 0.8rem;
        color: var(--text-muted);
        background: rgba(15, 23, 42, 0.9);
        border-radius: 10px;
        border: 1px dashed rgba(148, 163, 184, 0.5);
        padding: 8px 10px;
      }

      /* Popup de confirmation */
      .confirm-overlay {
        position: fixed;
        inset: 0;
        background: rgba(15, 23, 42, 0.85);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 999;
      }

      .confirm-modal {
        background: radial-gradient(circle at top, rgba(0, 169, 224, 0.22), #020617 55%);
        border-radius: 16px;
        padding: 18px 18px 14px;
        width: min(420px, 90vw);
        border: 1px solid rgba(148, 163, 184, 0.6);
        box-shadow: 0 22px 50px rgba(15, 23, 42, 0.95);
      }

      .confirm-title {
        font-size: 0.95rem;
        font-weight: 600;
        margin-bottom: 8px;
        color: var(--accent-blue);
        letter-spacing: 0.04em;
        text-transform: uppercase;
      }

      .confirm-message {
        font-size: 0.85rem;
        color: var(--text-muted);
        margin-bottom: 14px;
      }

      .confirm-actions {
        display: flex;
        justify-content: flex-end;
        gap: 8px;
      }

      @media (max-width: 640px) {
        .app {
          max-width: 98vw;
          padding: 12px 10px 18px;
        }
        h1 {
          font-size: 1.1rem;
        }
        .card {
          padding: 12px 12px 14px;
        }
      }
    </style>
  </head>
  <body>
    <div class="app">
      <header>
        <h1>20 objectifs inspirés des 40 hadiths</h1>
        <p class="subtitle">Coche ce que tu appliques aujourd'hui, puis observe ta progression.</p>
      </header>

      <div class="layout">
        <!-- Colonne gauche : journée -->
        <div>
          <section class="card">
            <div class="card-title">
              <span>Journée en cours</span>
              <span class="card-subtitle" id="todayLabel"></span>
            </div>

            <div class="field">
              <label for="intent">Intention du jour</label>
              <input type="text" id="intent" placeholder="Aujourd'hui, je veux insister sur..." />
            </div>

            <div id="progressText"></div>
            <div id="progressBar">
              <div id="progressFill"></div>
            </div>

            <ul id="todos"></ul>

            <div class="actions-row">
              <button id="resetDay" class="btn btn-danger">Reset journée</button>
              <button id="validateDay" class="btn btn-primary">Valider la journée</button>
            </div>

            <div class="intent-box" id="intentBox" style="display: none"></div>
          </section>

          <section class="card">
            <div class="card-title">
              <span>Badges</span>
            </div>
            <div class="badges-row" id="badgesRow">
              <span class="info">Aucun badge pour le moment.</span>
            </div>

            <div class="field" style="margin-top: 10px">
              <label for="targetPercent">Objectif de pourcentage (7 jours consécutifs)</label>
              <input type="number" id="targetPercent" min="10" max="100" value="70" />
              <span class="info">Ex : 70 = viser au moins 70% pendant 7 jours d'affilée.</span>
            </div>
          </section>
        </div>

        <!-- Colonne droite : stats & recap -->
        <div>
          <section class="card">
            <div class="card-title">
              <span>Récapitulatif des journées</span>
              <button id="btnExport" class="btn btn-secondary">Export CSV</button>
            </div>
            <div class="recap-title">Pourcentage et comparatif par jour</div>
            <table id="recapTable">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>% réussite</th>
                  <th>Comparatif</th>
                </tr>
              </thead>
              <tbody id="recapBody">
                <tr>
                  <td colspan="3" class="empty">Aucune journée enregistrée pour le moment.</td>
                </tr>
              </tbody>
            </table>
          </section>

          <section class="card">
            <div class="card-title">
              <span>Vue semaine & mois</span>
            </div>
            <div class="recap-title">7 derniers jours</div>
            <div class="bar-graph" id="barGraph"></div>

            <div class="recap-title" style="margin-top: 12px">Heatmap du mois courant</div>
            <div class="heatmap" id="heatmap"></div>
          </section>

          <section class="card">
            <div class="card-title">
              <span>Statistiques par objectif</span>
            </div>
            <table class="objectifs-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Objectif</th>
                  <th>% de jours réussi</th>
                </tr>
              </thead>
              <tbody id="objectifsStatsBody">
                <tr>
                  <td colspan="3" class="empty">Pas encore de données.</td>
                </tr>
              </tbody>
            </table>
          </section>
        </div>
      </div>
    </div>

    <!-- Popup de confirmation -->
    <div id="confirmOverlay" class="confirm-overlay" style="display: none">
      <div class="confirm-modal">
        <div class="confirm-title">Confirmer</div>
        <div class="confirm-message" id="confirmMessage">Es-tu sûr ?</div>
        <div class="confirm-actions">
          <button id="confirmCancel" class="btn btn-secondary">Annuler</button>
          <button id="confirmOk" class="btn btn-primary">Valider</button>
        </div>
      </div>
    </div>

    <script>
      // --------- DONNÉES DE BASE ---------
      const OBJECTIFS = [
        "Faire chaque acte avec une intention sincère",
        "Réciter la chahada et renouveler ma foi",
        "Accomplir les cinq prières obligatoires à l’heure",
        "Lire ou réviser un passage du Coran",
        "Conseiller autrui avec bonté et sincérité",
        "Choisir ce qui est licite, refuser ce qui est douteux",
        "Aimer pour autrui ce que j’aime pour moi-même",
        "Garder le contrôle de ma langue et éviter la médisance",
        "Être patient face à l’épreuve et contrôler ma colère",
        "Chercher la perfection dans mes actions (ihsan)",
        "Faire preuve d’humilité et éviter l’orgueil",
        "Honorer et respecter parents et proches",
        "Pardonner à ceux qui m’ont blessé",
        "Encourager le bien, décourager le mal",
        "Remercier Allah chaque jour",
        "Se rappeler la mort et l’au-delà",
        "Comprendre un hadith ou son application",
        "Être généreux (aumône, action positive)",
        "Respecter mes engagements et ma parole",
        "Demander pardon pour mes erreurs",
      ];

      const STORAGE_KEY = "nawawiDaily_simple";

      // --------- HELPERS ---------
      function todayKey() {
        const d = new Date();
        const y = d.getFullYear();
        const m = String(d.getMonth() + 1).padStart(2, "0");
        const day = String(d.getDate()).padStart(2, "0");
        return `${y}-${m}-${day}`;
      }

      function loadState() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          const data = raw ? JSON.parse(raw) : {};
          return typeof data === "object" && data !== null ? data : {};
        } catch {
          return {};
        }
      }

      function saveState() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(dailyData));
      }

      function emptyDay() {
        return {
          checks: Array(OBJECTIFS.length).fill(false),
          intent: "",
          percent: 0,
          validated: false,
        };
      }

      // --------- ÉTAT ---------
      let dailyData = loadState();
      const currentDay = todayKey();
      if (!dailyData[currentDay]) dailyData[currentDay] = emptyDay();

      // --------- DOM ---------
      const todosEl = document.getElementById("todos");
      const progressTextEl = document.getElementById("progressText");
      const progressFillEl = document.getElementById("progressFill");
      const todayLabel = document.getElementById("todayLabel");
      const intentInput = document.getElementById("intent");
      const intentBox = document.getElementById("intentBox");
      const resetDayBtn = document.getElementById("resetDay");
      const validateDayBtn = document.getElementById("validateDay");
      const recapBody = document.getElementById("recapBody");
      const confirmOverlay = document.getElementById("confirmOverlay");
      const confirmMessageEl = document.getElementById("confirmMessage");
      const confirmCancelBtn = document.getElementById("confirmCancel");
      const confirmOkBtn = document.getElementById("confirmOk");

      todayLabel.textContent = "Aujourd'hui : " + currentDay;

      // --------- PROGRESSION ---------
      function updateProgress() {
        const state = dailyData[currentDay];
        const total = OBJECTIFS.length;
        const doneCount = state.checks.filter(Boolean).length;
        const percent = total === 0 ? 0 : Math.round((doneCount / total) * 100);

        state.percent = percent;
        saveState();

        // maj texte + barre
        progressTextEl.textContent =
          "Progression : " + doneCount + " / " + total + " (" + percent + "%)";
        progressFillEl.style.width = percent + "%";
      }

      // --------- INTENTION ---------
      function renderIntent() {
        const state = dailyData[currentDay];
        intentInput.value = state.intent;
        if (state.intent && state.intent.trim().length > 0) {
          intentBox.style.display = "block";
          intentBox.textContent = "Intention : " + state.intent;
        } else {
          intentBox.style.display = "none";
        }
      }

      intentInput.addEventListener("input", () => {
        const state = dailyData[currentDay];
        state.intent = intentInput.value.trim();
        saveState();
        renderIntent();
      });

      // --------- TODOS ---------
      function renderTodos() {
        todosEl.innerHTML = "";
        const state = dailyData[currentDay];
        const isValidated = state.validated;

        OBJECTIFS.forEach((text, index) => {
          const li = document.createElement("li");
          li.className = "todo" + (state.checks[index] ? " checked" : "");

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.checked = !!state.checks[index];
          checkbox.disabled = isValidated;

          const label = document.createElement("label");
          label.textContent = text;

          checkbox.addEventListener("change", () => {
            if (state.validated) return;
            state.checks[index] = checkbox.checked;
            li.classList.toggle("checked", checkbox.checked);
            saveState();
            updateProgress();
          });

          li.appendChild(checkbox);
          li.appendChild(label);
          todosEl.appendChild(li);
        });

        updateProgress(); // calcul initial
      }

      // --------- POPUP CONFIRM ---------
      function openConfirm(message, onOk) {
        confirmMessageEl.textContent = message;
        confirmOverlay.style.display = "flex";

        const handleCancel = () => {
          confirmOverlay.style.display = "none";
          cleanup();
        };
        const handleOk = () => {
          confirmOverlay.style.display = "none";
          cleanup();
          if (typeof onOk === "function") onOk();
        };
        function cleanup() {
          confirmCancelBtn.removeEventListener("click", handleCancel);
          confirmOkBtn.removeEventListener("click", handleOk);
        }

        confirmCancelBtn.addEventListener("click", handleCancel);
        confirmOkBtn.addEventListener("click", handleOk);
      }

      // --------- BOUTONS ---------
      resetDayBtn.addEventListener("click", () => {
        openConfirm("Remettre à zéro toutes les cases et l’intention pour aujourd’hui ?", () => {
          dailyData[currentDay] = emptyDay();
          saveState();
          renderTodos();
          renderIntent();
          renderRecap();
        });
      });

      validateDayBtn.addEventListener("click", () => {
        const state = dailyData[currentDay];
        const total = OBJECTIFS.length;
        const doneCount = state.checks.filter(Boolean).length;
        const percent = total === 0 ? 0 : Math.round((doneCount / total) * 100);

        openConfirm(
          `Valider la journée avec ${doneCount} objectifs sur ${total} (${percent}%) ?`,
          () => {
            state.percent = percent;
            state.validated = true;
            saveState();
            renderTodos();
            renderRecap();
          }
        );
      });

      // --------- RÉCAP SIMPLE ---------
      function renderRecap() {
        recapBody.innerHTML = "";
        const dates = Object.keys(dailyData).sort();
        if (dates.length === 0) {
          const tr = document.createElement("tr");
          const td = document.createElement("td");
          td.colSpan = 3;
          td.className = "empty";
          td.textContent = "Aucune journée enregistrée pour le moment.";
          tr.appendChild(td);
          recapBody.appendChild(tr);
          return;
        }

        let prevPercent = null;
        dates.forEach((d) => {
          const info = dailyData[d];
          const percent = info.percent || 0;

          const tr = document.createElement("tr");

          const tdDate = document.createElement("td");
          tdDate.textContent = d === currentDay ? "Aujourd'hui (" + d + ")" : d;
          tr.appendChild(tdDate);

          const tdPercent = document.createElement("td");
          tdPercent.textContent = percent + " %";
          tdPercent.className = percent === 100 ? "percent-good" : "percent-bad";
          tr.appendChild(tdPercent);

          const tdCompare = document.createElement("td");
          if (prevPercent === null) {
            tdCompare.textContent = "—";
            tdCompare.className = "compare-same";
          } else if (percent > prevPercent) {
            tdCompare.textContent = "Mieux que la veille";
            tdCompare.className = "compare-better";
          } else if (percent < prevPercent) {
            tdCompare.textContent = "Moins bien que la veille";
            tdCompare.className = "compare-worse";
          } else {
            tdCompare.textContent = "Même niveau";
            tdCompare.className = "compare-same";
          }
          tr.appendChild(tdCompare);

          prevPercent = percent;
          recapBody.appendChild(tr);
        });
      }

      // --------- INIT ---------
      renderIntent();
      renderTodos();
      renderRecap();
    </script>
  </body>
</html>
